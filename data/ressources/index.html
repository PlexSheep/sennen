<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>千年 - Daily Japanese</title>
        <link
            href="https://cdn.jsdelivr.net/npm/tailwindcss@2/dist/tailwind.min.css"
            rel="stylesheet"
        />
    </head>
    <body class="bg-gray-100">
        <div class="container mx-auto px-4 py-8">
            <h1 class="text-4xl font-bold mb-8">千年 - Daily Japanese</h1>

            <div id="today" class="bg-white rounded-lg shadow-lg p-6 mb-8">
                <h2 class="text-2xl font-bold mb-4">Today's Kanji</h2>
                <div id="todayContent" class="animate-pulse">Loading...</div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <a
                    href="#"
                    id="yesterdayLink"
                    class="bg-white rounded-lg shadow p-4 hover:shadow-lg transition-shadow"
                >
                    Yesterday's Kanji
                </a>
                <a
                    href="#"
                    id="tomorrowLink"
                    class="bg-white rounded-lg shadow p-4 hover:shadow-lg transition-shadow"
                >
                    Tomorrow's Kanji
                </a>
            </div>
        </div>

        <script>
            // Define base URL once, will be available for all subsequent scripts
            window.BASE_URL = window.location.hostname.endsWith("github.io")
                ? "/sennen" // GitHub Pages
                : ""; // Any other host

            // Load common.js and wait for it
            function loadCommonJs() {
                return new Promise((resolve) => {
                    const script = document.createElement("script");
                    script.src = `${window.BASE_URL}/js/common.js`;
                    script.onload = resolve;
                    document.head.appendChild(script);
                });
            }

            async function updatePage() {
                const today = new Date();
                const todayData = await loadDailyData(today);

                if (todayData) {
                    const kanji = todayData.kanji;
                    document.getElementById("todayContent").innerHTML = `
                        <a href="kanji.html?date=${todayData.date}" class="block">
                            <div class="text-6xl mb-4">${kanji.kanji}</div>
                            <div class="text-xl">${kanji.meanings.join(", ")}</div>
                        </a>
                    `;

                    // Update navigation links
                    const yesterday = new Date(today);
                    yesterday.setDate(yesterday.getDate() - 1);
                    const tomorrow = new Date(today);
                    tomorrow.setDate(tomorrow.getDate() + 1);

                    document.getElementById("yesterdayLink").href = getKanjiUrl(
                        getPreviousDay(today),
                    );
                    document.getElementById("tomorrowLink").href = getKanjiUrl(
                        getNextDay(today),
                    );
                }
            }

            // Initialize page after common.js is loaded
            async function init() {
                await loadCommonJs();
                // Now we can safely call functions from common.js
                await updatePage();
            }
            init();
        </script>
    </body>
</html>
